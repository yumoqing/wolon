!function(s){function r(t){var e=(s=jQuery)(this).parents(".urlbrowser"),a=e[0].getElementsByTagName("input"),n=(s.data(e[0],"urlbrowser"),t.path+"/"+t.name);s(a).val(n),console.log("path,name,v=",t.path,t.name,n)}function d(t){var e=(s=jQuery)(this).parents(".urlbrowser"),a=s.data(e[0],"urlbrowser");if("dir"!=t.type){var n=t.path+"/"+t.name;console.log("p = ",n),a.options.onSelectFile&&a.options.onSelectFile.call(this,n),e.window("close")}else"closed"==t.state?s("#"+a.tgid).treegrid("expand",t.id):s("#"+a.tgid).treegrid("collapse",t.id)}s.fn.urlbrowser=function(n,t){if("string"==typeof n){var e=s.fn.urlbrowser.methods[n];if(e)return e(this,t)}return n=n||{},this.each(function(){var t=s.data(this,"urlbrowser");if(t)s.extend(t.options,n);else{var e=objExt({},s.fn.urlbrowser.defaults,s.fn.urlbrowser.parseOptions(this),n);s.data(this,"urlbrowser",{options:e,tbid:getId("toolbar"),tgid:getId("treegrid")}),t=s.data(this,"urlbrowser")}var a={width:600,height:480,modal:!0};switch(t.options.browsetype){case"save":a.iconCls="icon-save",a.title=i18n("save");break;case"saveas":a.iconCls="icon-save",a.title=i18n("save as");break;case"open":default:a.iconCls="icon-open",a.title=i18n("open")}s(this).window(a),function(e){var t=s(e).window("body"),a=s.data(e,"urlbrowser"),n="open"==a.options.browsetype?i18n("open"):i18n("save");t.empty(),s(e).addClass("urlbrowser"),s('<div id="'+a.tbid+'"><input class="easyui-textbox" value="" style="width:400px" /><button onclick="$(this).parents(\'.urlbrowser\').urlbrowser(\'baction\');" >'+n+"</button>").appendTo(t),s.parser.parse(s(e)),s(".textbox-text",s(e))[0].onkeydown=function(t){console.log("e.keyCode"),13==t.keyCode&&(console.log("return key entered"),s(e).urlbrowser("baction"))};var o={id:a.tgid,url:a.options.url,idField:"id",treeField:"name",fields:[{name:"name",width:"290px",label:i18n("filename"),iotype:"text"},{name:"type",width:"70px",label:i18n("filetype"),iotype:"text"},{name:"size",label:"filesize",iotype:"text"},{name:"mtime",label:i18n("filemtime"),iotype:"text"}],options:{pagination:!1,dnd:!1,toolbar:"#"+a.tbid,pageSize:60,onClickRow:r,onDblClickRow:d}},i=tmplRender("treegrid",o);s(i).appendTo(t),s.parser.parse(s(e))}(this),s(this).window("open")})},s.fn.urlbrowser.methods={baction:function(t){var e=t[0],a=e.getElementsByTagName("input"),n=s(a).val();if(n){var o=s.data(e,"urlbrowser"),i=s("#"+o.tgid).treegrid("getSelected"),r="";if(i&&(r+=i.path+"/"+i.name),r!=n)r+="/"+n;else if("dir"==i.type)return;o.options.onSelectFile&&o.options.onSelectFile.call(this,r),s(e).window("close")}else s.messager.alert(i18n("error"),i18n("please input a filename"))},newfolder:function(t){var e=t[0],a=e.getElementsByTagName("input"),n=s(a).val();if(n){var o=s.data(e,"urlbrowser"),i=s("#"+o.tgid).treegrid("getSelected"),r="";i&&(r+=i.path+"/"+i.name),r!=n&&(r+="/"+n,"dir"==i.type&&(o.options.newfolderURL&&remoteCall(o.options.newfolderURL,"GET","json",{url:r},function(t){t.status&&t.errortype&&t.errmsg&&s.messager.alert(t.status+":"+t.errortype,t.errmsg)},function(t){s.messager.alert("error",t)}),s(e).window("close")))}else s.messager.alert(i18n("error"),i18n("please input a filename"))},options:function(t){return s.data(t[0],"urlbrowser").options}},s.fn.urlbrowser.parseOptions=function(t){return s.extend({},s.parser.parseOptions(t,["width","height","class"]))},s.fn.urlbrowser.defaults={browsetype:"open"},s.parser.plugins.push("urlbrowser")}(jQuery);try{1==wolon&&debug("wolon loaded")}catch(e){function JsonObject(o){if(Object.prototype.toString.call(o)==Object.prototype.toString.call("")){if(o.startsWith("jsscript:")){var x=o.substring(9,o.length);return eval("__jsonobject__js="+x)}return o}if(Object.prototype.toString.call(o)==Object.prototype.toString.call({}))for(var i in o)o.hasOwnProperty(i)&&(o[i]=JsonObject(o[i]));if(Object.prototype.toString.call(o)==Object.prototype.toString.call([]))for(var i=0;i<o.length;i++)o[i]=JsonObject(o[i]);return o}function clearClipBoard(){var t=$("body");$.data(t[0],"clipboard",{})}function setClipBoard(t,e){var a=$("body")[0];$.data(a,"clipboard",{dtype:e})}function getClipBoard(){var t=$("body")[0];return $.data(t,"clipboard")}function isError(t){return t.hasOwnProperty("errortype")&&t.hasOwnProperty("errmsg")}function showError(t){$.messager.alert("error:",t)}function showSysError(t){$.messager.alert("error:js error",t)}function money(e,a){a=0<a&&a<=20?a:2;var n=(e=parseFloat((e+"").replace(/[^\d\.-]/g,"")).toFixed(a)+"").split(".")[0].split("").reverse(),o=e.split(".")[1];for(t="",i=0;i<n.length;i++)t+=n[i]+((i+1)%3==0&&i+1!=n.length?",":"");return t.split("").reverse().join("")+"."+o}function addTooltip(t,e){$("#"+e).tooltip({position:"bottom",content:t,onShow:function(){$(this).tooltip("tip").css({backgroundColor:"#e0e0e0",color:"#e80000",borderColor:"#97CBFF"})}})}function guid(){return"xxxxxxxxxxxxxxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return e.toString(16)})}function contains(t){for(var e=0;e<this.length;e++)if(this[e]===t)return!0;return!1}function notcontains(t){for(var e=0;e<this.length;e++)if(this[e]===t)return!1;return!0}wolon=1,wolon_modules={},debug=function(){},callLater=function(t,e){setTimeout(e,100*t)},isVisible=function(t){return!($(window).scrollTop()>t.offset().top+t.outerHeight()||$(window).scrollTop()+$(window).height()<t.offset().top)&&!!t.is(":visible")},browser=function(){var t,e={},a=navigator.userAgent.toLowerCase();return(t=-1!==a.indexOf("edge")?e.edge="edge":a.match(/rv:([\d.]+)\) like gecko/))?e.ie=t[1]:(t=a.match(/msie ([\d.]+)/))?e.ie=t[1]:(t=a.match(/firefox\/([\d.]+)/))?e.firefox=t[1]:(t=a.match(/chrome\/([\d.]+)/))?e.chrome=t[1]:(t=a.match(/opera.([\d.]+)/))?e.opera=t[1]:(t=a.match(/version\/([\d.]+).*safari/))&&(e.safari=t[1]),e},objExt=function(){for(var i={},t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);return t.map(function(t){if(!isNull(t))if(Object.prototype.toString.apply(i)==Object.prototype.toString.apply(t))if(Object.prototype.toString.apply(t)!=Object.prototype.toString.apply([]))if(Object.prototype.toString.apply(t)!=Object.prototype.toString.apply({}))i=t;else for(var e in t)i.hasOwnProperty(e)?i[e]=objExt(i[e],t[e]):i[e]=t[e];else{debug("o is a array",i,t);for(var a=[],n=Math.min(t.length,i.length),o=Math.max(t.length,i.length),e=0;e<n;e++)a.push(objExt(i[e],t[e]));for(e=n;e<=o;e++)n==t.length?a.push(i[e]):a.push(t[e]);i=a}else i=t}),i},kmapping=function(t,e){var a={};for(var n in t){a[e[n]]=t[n]}return a},vmapping=function(t,e){var a;for(var n in t)e.hasOwnProperty(t[n])?a[n]=e[t[n]]:e.hasOwnProperty("__else__")?a[n]=e.__else__:a[n]=t[n];return a},strWidget=function(s,target,method){var data=s;"replace"==method&&target.empty();var step=0,widgetdesc;try{if(widgetdesc=eval("__widget_description__ = "+data),isNull(widgetdesc))return void console.log("widgetdesc is null");step=1;try{widgetdesc=JsonObject(widgetdesc)}catch(t){console.log("widgetdesc=",widgetdesc,t)}widgetdesc.hasOwnProperty("__ctmpl__")?(step=2,$(tmplRender(widgetdesc.__ctmpl__,widgetdesc.data)).appendTo(target)):widgetdesc.hasOwnProperty("__widget__")?(step=3,eval("$(target)."+widgetdesc.__widget__+"(widgetdesc.data)")):(step=4,$(data).appendTo(target))}catch(t){$(data).appendTo(target)}$.parser.parse(target)},remoteWidgets=function(e,a,n,o,i){if(0<e.length){var t=e.shift();remoteCall(t,"GET","html",a,function(t){strWidget(t,n,o),0<e.length&&remoteWidgets(e,a,n,"append",i)},i)}},remoteWidget=function(t,e,a,n,o){remoteCall(t,"GET","html",e,function(t){strWidget(t,a,n)},o)},rsaEncode=function(t){var e=getPublicKey(),a=forge.pki,n=a.publicKeyFromPem(e),o=n.encrypt(t,"RSA-OAEP",{md:forge.md.sha256.create()}),i=forge.util.encode64(o);return console.log("rsaEncode():encrypted=",i,a.publicKeyToPem(n)),i},remoteCall=function(o,i,r,s,d,l,a){$.ajax({method:i||"GET",url:o,cache:!1,async:!0,dataType:r||"html",data:s,beforeSend:function(t){if(void 0!==a&&0<a.length)for(var e=0;e<a.length;e++)t.setRequestHeader(a[e][0],a[e][1])},success:function(t){var e=!1;if("json"==r)e=t;else try{e=$.parseJSON(t)}catch(t){}if("object"!=typeof e||"error"!=e.status||69999!=e.errorcode)d(t);else{var a=getLoginWindow(),n=[o,i,r,s,d,l];a.loginwindow("dologin",n)}},error:function(t,e,a){var n={title:a,msg:"error:"+o+":"+t.statusText,showType:"slide",icon:"error",timeout:5e3};$.messager.show(n),l(t,e,a)}})},tmplRender=function(t,e){var a={__ctmpl__:t,data:e};return ClientTemplate.createNew().render(a)},strTmplRender=function(t,e){return ClientTemplate.createNew().tmplTextRender(t,e)},remoteJson=function(o,t,e,a){return $.ajax({method:e||"GET",url:o,cache:a||!1,async:!0,success:t,dataType:"json",error:function(t,e,a){var n={title:a,msg:"error:"+o+":"+t.statusText,showType:"slide",icon:"error",timeout:5e3};$.messager.show(n)}})},isNull=function(t){return"null"==String(t)},deepCopy=function(t,e){e=e||{};for(var a in t)"object"==typeof t[a]?(e[a]=t[a].constructor===Array?[]:{},deepCopy(t[a],e[a])):e[a]=t[a];return e},ClientI18N={i18ndict:{},dicturl:"/getI18nDict.dspy",loadDict:function(){remoteJson(ClientI18N.dicturl,function(t){ClientI18N.i18ndict=t})},createNew:function(){return ClientI18N.loadDict(),i18n=function(t,e){return ClientI18N.i18ndict.hasOwnProperty(t)?d=ClientI18N.i18ndict[t]:d=t,doT.template(d,void 0,{})(e)},i18n}},i18n=ClientI18N.createNew(),MetaData={metadata:{},loadMeta:function(t){remoteJson(t,function(t){MetaData.metadata=t})},get:function(t){return MetaData.metadata.hasOwnProperty(t)?MetaData.metadata[t]:{}}},WidgetCalls={calls:{},namedId:{},createNew:function(){return{execute:function(t,e,a,n){if(!WidgetCalls.calls.hasOwnProperty(t))return debug("WidgetCalls().calls",t,"not defined","when execue with",t,e,a),!1;var o=0,i=WidgetCalls.calls[t];if(i.hasOwnProperty(e)){var r=i[e];if(!isNull(r)&&0<r.length)for(var s=0;s<r.length;s++)a=r[s](a),o++}if(i.hasOwnProperty("*")){r=i["*"];if(!isNull(r)&&0<r.length)for(s=0;s<r.length;s++)a=r[s](a),o++}if(0==o&&i.hasOwnProperty("#")){r=i["#"];if(!isNull(r)&&0<r.length)for(s=0;s<r.length;s++)a=r[s](a),o++}return a},init:function(t){WidgetCalls.calls[t]={}},add:function(t,e,a){WidgetCalls.calls.hasOwnProperty(t)||(WidgetCalls.calls[t]={});var n=WidgetCalls.calls[t];n.hasOwnProperty(e)||(n[e]=new Array);for(var o=0;o<WidgetCalls.calls[t][e].length;o++)if(a==WidgetCalls.calls[t][e][o])return;WidgetCalls.calls[t][e].push(a),debug("wc.add():here",t,e)}}}},tmplurl=function(t,e){return doT.template(t,void 0,{})(e)},getId=function(t){WidgetCalls.namedId.hasOwnProperty(t)||(WidgetCalls.namedId[t]=0);var e=t+"_"+WidgetCalls.namedId[t];return WidgetCalls.namedId[t]+=1,e},isArrayFn=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},quotconv=function(t){return t.replace('"','\\"').replace("'","\\'")},dump=function(t){new Array;if("string"==typeof t)return"'"+t+"'";if(isArrayFn(t)){for(var e="[",a=0;a<t.length;a++)e+=dump(t[a]),a<t.length-1&&(e+=",");return e+="]"}if(typeof t!=typeof{})return String(t);e="{";var n=!1;for(var a in t)n&&(e+=","),n=!0,e+=a+":"+dump(t[a]);return e+="}"},dataoption_dump=function(t){var e=dump(t);return"{"==e[0]?e.substring(1,e.length-1):t},CodeMapping={codes:{}},setIdByCatelog=function(t){t.hasOwnProperty("id")||(t.hasOwnProperty("widget_name")?t.id=getId(t.widget_name):t.id=getId("misc"))},catelogCreated=function(t,e){WidgetCalls.createNew().execute(t,"created",e,null)},isModuleLoaded=function(t){return wolon_modules.hasOwnProperty("modulename")},moduleLoaded=function(t){wolon_modules.modulename=1},widgetCreated=function(t,e){var a={widget_type:t,id:e},n=WidgetCalls.createNew();n.init(e);var o=t+":"+e;n.execute(o,"created",a,null),debug("widgetCreated()",o)},RegisterFunction={rfs:{},createNew:function(){return{register:function(t,e){RegisterFunction.rfs[t]=e},call:function(t){if(RegisterFunction.rfs.hasOwnProperty(t)){var e=new Array;for(i=1;i<arguments.length;i++)e[i-1]=arguments[i];return debug("RegisterFunction",e),RegisterFunction.rfs[t](e)}debug("registor function(",t,") not found")}}}},partedColor=function(t,e,a){var n,o,i,r=[],s=a-1,d=function(t){var e={};return e.x=parseInt(t.substring(1,3),16),e.y=parseInt(t.substring(3,5),16),e.z=parseInt(t.substring(5,7),16),e};n=d(t),o=d(e),r.push(t);for(var l=1;l<s;l++){var p={};p.x=(n.x+o.x)*l/s,p.y=(n.y+o.y)*l/s,p.z=(n.z+o.z)*l/s,r.push("#"+(i=p).x.toString(16)+i.y.toString(16)+i.z.toString(16))}return r.push(e),debug("partedColor()",a,r),r},canGetGeoLocation=function(){return!!navigator.geolocation},getGeoLocation=function(t,e,a,n){return t?watchCurrentPosition(e,a,n):getCurrentPosition(e,a,n)},centerLocation=function(t,e,a){var n=t.length,o={};e=0,a=0;return t.map(function(t){e+=t[e]*Math.PI/180,a+=t[a]*Math.PI/180}),a/=n,o[e/=n]=e,o[a]=a,o},Array.prototype.contains=contains,Array.prototype.notcontains=notcontains,test1=function(t){},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(t){return this.slice(0,t.length)===t}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(t){return-1!==this.indexOf(t,this.length-t.length)})}!function(o){function n(){var t=o(this).scrollTop(),e=o(this)[0].scrollHeight;.95<=(t+o(this).height())/e&&i(this)}function i(a){var n=o.data(a,"bufferedpanel");if(!(0<n.page&&n.page>=n.maxpage)){n.page=n.page+1;var t=n.options.params;t.page=n.page,t.rows=n.options.pageSize,t._=Date.parse(new Date);var e=n.options.method||"POST";remoteCall(n.options.url,e,"json",t,function(t){for(var e=0;e<t.rows.length;e++)o(strTmplRender(n.options.pattern,t.rows[e])).appendTo(o(a)),n.databuffer.push(t[e]);n.maxpage=Math.ceil(t.total/n.options.pageSize),o.data(a,"bufferedpanel",n),o.parser.parse(o(a))},showError)}}o.fn.bufferedpanel=function(e,t){if("string"==typeof e){var a=o.fn.bufferedpanel.methods[e];if(a)return a(this,t)}return e=e||{},this.each(function(){var t=objExt({},o.fn.bufferedpanel.defaults,o.fn.bufferedpanel.parseOptions(this),e);state=o.data(this,"bufferedpanel",{options:t,obj:function(t,e){return o(t).addClass("bufferedpanel"),o(t).on("scroll",n),o(t)}(this),page:0,maxpage:0,databuffer:[]}),t.pattern_url?function(e,a){var n=o.data(e,"bufferedpanel");remoteCall(n.options.pattern_url,"GET","text",{},function(t){n.options.pattern=t,o.data(e,"bufferedpanel",n),a&&a(e)},showError)}(this,i):i(this)})},o.fn.bufferedpanel.methods={options:function(t){return o.data(t[0],"bufferedpanel").options},readnext:function(t){i(t[0])},destroy:function(t){var e=t[0];o.data(e,"bufferedpanel",null),t.empty()}},o.fn.bufferedpanel.parseOptions=function(t){return o.extend({},o.parser.parseOptions(t,["width","height","class"]))},o.fn.bufferedpanel.defaults={pageSize:50,params:{}},o.parser.plugins.push("bufferedpanel")}(jQuery),function($){function setSize(t){if(void 0!==$.data(t,"datasheet")){var e=$(t).height(),a=$(".toolbar",$(t)),n=0;0<a.length&&(n=a.height());var o=e-n;$(".ds-body",$(t)).css("height",o)}}function onResize(t){setSize(t.target)}function createMain(t,e,a,n){var o=null;if(e.toolbar)o=$('<div class="ds-toolbar"></div>').css("height",e.toolbar_height.toString()+"px"||"35px");var i=$('<div class="ds-body"></div>');null==o?(i.appendTo($(t)),i.css("height","100%")):("north"==e.toolbar_position?(o.appendTo($(t)),i.appendTo($(t))):(i.appendTo($(t)),o.appendTo($(t))),i.css("height",($(t).height()-e.toolbar_height).toString()+"px")),null!=o&&a(o,e),n(i,e)}function init(u,t){$.data(u,"datasheet",{options:t}),$(u).empty(),$(u).addClass("datasheet"),$(u).css("align","center").css("text-align","center"),0==$(u).height()&&$(u).css("height","100%"),0==$(u).width()&&$(u).css("width","100%"),createMain(u,t,function(t,e){e.toolbar_url?remoteWidget(e.toolbar_url,{},t,"replace",showError):t.toolbar(e.toolbar)},function(t,d){widget_objs={};var l=$('<div class="datasheet-body"></div>').appendTo(t);function e(t){return $(tmplRender("datasheet_field",t))}l.css("width","100%"),l.css("height","100%"),d.title&&$('<div class="ds_title"><span>'+d.title+"</span></div>").appendTo(l),d.description&&$('<div class="ds_desc"><span>'+d.description+"</span></div>").appendTo(l);var r={hidden:{},text:{widget:"scripteditor",builder:e,options:{}},str:{widget:"textbox",builder:e,options:{}},date:{widget:"datebox",builder:e,options:{}},bool:{widget:"combobox",builder:e,options:{textField:"label",valueField:"value",data:[{value:!0,label:i18n("True")},{value:!1,label:i18n("False")}]}},number:{widget:"numberbox",builder:e,options:{precision:0}},url:{widget:"textbox",builder:e,options:{icons:[{iconCls:"icon-addfile",handler:function(t){$(t.data.target).textbox("clear")}}]}},code:{widget:"combobox",builder:e,options:{}},scripteditor:{widget:"scripteditor",builder:e,options:{}},select:{widget:"selectbox",builder:e,options:{}},onoff:{widget:"onoff",builder:e,options:{}},codetree:{widget:"combotree",builder:e,options:{}},codegrid:{widget:"combogrid",builder:e,options:{}},codetreegrid:{widget:"combotreegrid",builder:e,options:{}},password:{widget:"passwordbox",builder:e,options:{}},tag:{widget:"tagbox",builder:e,options:{}},json:{widget:"jsoneditor",builder:e,options:{}},records:{widget:"edatagrid",builder:e,options:{}}};function p(t,e){var a=$('<div class="lbox"></div>'),n=($(u).width(),r[t.iotype]),o=$.extend(n.options,t);t.onChange&&(opt.user_onChange=t.onChange),o.width=e+"px",t.valueheight&&(o.height=t.valueheight);var i=null;return n.builder&&(delete o.label,i=n.builder(o)),i.appendTo(a),widget_objs[t.name]=i,a}function c(t){var e=$('<div class="lbox datasheet-unit"></div>');e.attr("fieldname",t.name);var a=t.unitcnt||1;e.css("width",d.unitwidth*a);var n=t.name;return t.label&&(n=i18n(t.label)),$('<div class="lbox" ></div>').text(n+":").css("text-align","right").css("width",d.labelwidth).appendTo(e),e}function a(t){var e;(e=$.data(u,"datasheet")).fields=t,$.data(u,"datasheet",e);for(var a=e.data,n=0;n<t.length;n++){var o=objExt({},t[n]);if(o.hasOwnProperty("defaultvalue")&&(o.value=o.defaultvalue),a&&a.hasOwnProperty(o.name)&&(o.value=a[o.name]),d.readonly&&(o.readonly=!0),"hidden"!=o.iotype){var i=c(o),r=d.unitwidth,s=o.unitcnt||1;p(o,Math.floor(r*s-d.labelwidth)).appendTo(i),i.appendTo($(l))}}(e=$.data(u,"datasheet")).inObjs=widget_objs,$.data(u,"datasheet",e),$.parser.parse($(u))}function n(t){state=$.data(u,"datasheet",{options:d,data:t,typemapping:r}),d.fields_url?remoteCall(d.fields_url,"GET","json",{},function(t){a(t)},showError):a(d.fields),setSize(u)}d.data_url?remoteCall(d.data_url,"GET","json",{},n,function(t){showError(t)}):n({})}),$(u).bind("resize",onResize)}$.fn.datasheet=function(e,t){if("string"==typeof e){var a=$.fn.datasheet.methods[e];if(a)return a(this,t)}return e=e||{},this.each(function(){var t=$.data(this,"datasheet");t?$.extend(t.options,e):init(this,objExt({},$.fn.datasheet.defaults,$.fn.datasheet.parseOptions(this),e))})},$.fn.datasheet.methods={resize:function(t){setSize(t[0])},options:function(t){return $.data(t[0],"datasheet").options},valueChanged:function(jq,obj,nv){var fo=$(obj).parents(".datasheet-unit"),d={name:fo.attr("fieldname"),value:nv},state=$.data(jq[0],"datasheet");state.data[d.name]=d.value,$.data(jq[0],"datasheet",state),obj.user_onChange&&(obj.user_onChange.callable()?user_onChange.call(o,d):(callee=eval(obj.user_onChange),callee.call(o,d)))},callFieldFunction:function(jq,params){for(var name=params.name,fname=params.fname,args=params.args,state=$.data(jq[0],"datasheet"),wobj=state.inObjs[name],f=null,i=0;i<state.fields.length&&(f=state.fields[i],name!=f.name);i++);if(null!=f){var widget=state.typemapping[f.iotype].widget,cmd="wobj."+widget+"(fname,args)";return eval(cmd)}},disable:function(t,e){var a={name:e,fname:"disable",args:null};return $(t[0]).datasheet("callFieldFunction",a)},enable:function(t,e){var a={name:e,fname:"enable",args:null};return $(t[0]).datasheet("callFieldFunction",a)},setValue:function(jq,d){var state=$.data(jq[0],"datasheet");state.data=d,$.data(jq[0],"datasheet",state);for(var i=0;i<state.fields.length;i++){var f=state.fields[i];if(d.hasOwnProperty(f.name)&&"hidden"!=f.iotype){var obj=state.inObjs[f.name],cmd="obj."+state.typemapping[f.iotype].widget+'("setValue",d[f.name])';eval(cmd)}}},validate:function(jq){for(var state=$.data(jq[0],"datasheet"),i=0;i<state.fields.length;i++){var f=state.fields[i];if("hidden"!=f.iotype){var obj=state.inObjs[f.name],cmd="obj."+state.typemapping[f.iotype].widget+'("getValue")';if(r=eval(cmd),f.required&&(!r||""==r)){var wobj=state.inObjs[f.name];return wobj.focus(),!1}}}return!0},getValue:function(jq){var state=$.data(jq[0],"datasheet");ret={};for(var i=0;i<state.fields.length;i++){var f=state.fields[i];if("hidden"!=f.iotype){var obj=state.inObjs[f.name],cmd="obj."+state.typemapping[f.iotype].widget+'("getValue")';ret[f.name]=eval(cmd)}else ret[f.name]=f.value||f.defaultvalue}return state.data=$.extend(state.data,ret),$.data(jq[0],"datasheet",state),state.data}},$.fn.datasheet.parseOptions=function(t){return{}},$.fn.datasheet.defaults={toolbar_height:36,toolbar_position:"north",labelwidth:90,unitwidth:240,width:"100%",height:"100%"},$.parser.plugins.push("datasheet")}(jQuery),function($){function getData(t){return $(t).parents(".jsoneditor").jsoneditor("getValue")}function buildInput(t){return t.tree_target=this,void 0===t.value&&void 0!==t.defaultvalue&&(t.value=t.defaultvalue),"jsscript"==t.datatype&&t.value.startsWith("jsscript:")&&(t.value=t.value.substing(9)),ret=tmplRender("jsoneditorfield",t),ret}function menuCommand(t){var e=t[0],a=e.data.node,n=a.tree_target;if("attr"==e.data.typ){if($(n).jsoneditor("findChildByName",{node:a,name:e.data.name}))return;$(n).jsoneditor("addChildByName",{node:a,name:e.data.name})}else $(n).jsoneditor("addChildByType",{node:a,name:e.data.name})}var rf=RegisterFunction.createNew();function objectMenu(){return[{name:"str",typ:"type"},{name:"number",typ:"type"},{name:"jsscript",typ:"type"},{name:"url",typ:"type"},{name:"date",typ:"type"},{name:"bool",typ:"type"},{name:"text",typ:"type"},{name:"ARRAY",typ:"type"},{name:"OBJECT",typ:"type"}]}function contextMenu(t){function e(t){$(tmplRender("menu",t)).appendTo("body"),$.parser.parse($("body"))}var a=t.tree_target,n=($.data(a,"jsoneditor"),{id:t.id+"_menu",registerfunction:"jem_command",width:"150px"});if(t.menubuild="Y","OBJECT"!=t.datatype&&"ARRAY"!=t.datatype||(n.submenu=objectMenu(),e(n)),"OBJECT"==t.basetype){for(var o=[],i=0;i<t.fields.length;i++)t.fields[i].required||o.push({name:t.fields[i].name,typ:"attr"});o.push("-"),t.allowNewAttributes&&(o=o.concat(objectMenu())),n.submenu=o,e(n)}if("ARRAY"==t.basetype){o=[];if(t.allowedTypes)for(i=0;i<t.allowedTypes.length;i++)Object.prototype.toString.apply(t.allowedTypes[i])==Object.prototype.toString.apply("")?o.push({name:t.allowedTypes[i],typ:"type"}):o.push({name:t.allowedTypes[i].datatype,typ:"type"});else o=objectMenu();n.submenu=o,e(n)}}function validateNode(t,e){if($(t).jsoneditor("options").atomtypes.contains(e.datatype)&&e.required&&"bool"!=e.datatype&&!e.value)return $(t).jsoneditor("expandTo",e.target),$(t).jsoneditor("select",e.target),$("#"+e.id+"_v").next("span").find("input").focus(),console.log("validate failed",e),!1;if(e.children)for(var a=0;a<e.children.length;a++)if(!validateNode(t,e.children[a]))return!1;return!0}function nodeValue(t){var e=t.datatype;switch(t.basetype&&(e=t.basetype),e){case"str":case"text":case"date":case"number":case"url":case"bool":case"code":case"urlcode":return t.name?((o={})[t.name]=t.value,o):t.value;case"jsscript":return t.name?((o={})[t.name]="jsscript:"+t.value,o):"jsscript:"+t.value;case"OBJECT":var a={};t.children||(t.children=[]);for(var n=0;n<t.children.length;n++)a=objExt(a,nodeValue(t.children[n]));return t.name?((o={})[t.name]=a,o):a;case"ARRAY":a=[];t.children||(t.children=[]);for(n=0;n<t.children.length;n++)a.push(nodeValue(t.children[n]));return t.name?((o={})[t.name]=a,o):a;default:var o;return t.name?((o={})[t.name]=t.value,o):t.value}}function getTypeByTypeName(t,e){if(t){for(var a=0;a<t.length;a++)if(t[a].datatype==e)return t[a];return null}}function showMenu(target,node,e){if($.parser.parse($("#"+node.id+"_menuc")),options=$(target).jsoneditor("options"),node.menubuild){$(target).tree("select",node.target);var d={event:e,data:{node:node}};eval("obj_"+node.id+"_menu.setValue(d)")}}function guessDatatype(t,e){switch(r=typeof e){case"string":return e.match(/^(\d{4})(-)(\d{2})\2(\d{2})$/)?"date":"{{absurl"==e.substring(0,8)?"url":"/"==e[0]||"./"==e.substring(0,2)||"../"==e.substring(0,3)||"http://"==e.substring(0,7)||"https://"==e.substring(0,8)?"url":-1!=e.indexOf("\n")?"text":e.startsWith("jsscript:")?"jsscript":"str";case"number":case"number":return"number";case typeof!0:return"bool";default:if(Object.prototype.toString.apply(e)==Object.prototype.toString.apply([])){if(s="ARRAY",d=0,t)for(var a=0;a<t.length;a++)if("ARRAY"==t[a].basetype){for(var n=!0,o=0,i=0;i<e.length;i++){var r=guessDatatype(t,e[i]);t[a].allowedTypes.contains(r)?o++:n=!1}n&&d<o&&(t[a].datatype,d=o)}return s}if(Object.prototype.toString.apply(e)!=Object.prototype.toString.apply({}))break;var s="OBJECT",d=0;if(0<t.length)for(a=0;a<t.length;a++)if("OBJECT"==t[a].basetype){for(n=!0,o=0,i=0;i<t[a].fields.length;i++)e.hasOwnProperty(t[a].fields[i].name)?o+=1:t[a].fields[i].required&&(n=!1);n?d<o&&(s=t[a].datatype,d=o):console.log("miss matched type,d=",t[a],e)}return s}}function _setupObject(t,e,a){var n=$.data(t,"jsoneditor");n.options.atomtypes;e.registed&&!e.basetype&&(e=objExt(e,getTypeByTypeName(n.options.registerTypes,e.datatype)));var o=objExt({id:guid()},e);switch(o.datatype){case"str":return o.value="string"==typeof a?a:e.defaultvalue||"",o;case"jsscript":return o.value="",o;case"text":return o.value="string"==typeof a?a:e.defaultvalue||"",o;case"number":return o.value="number"==typeof a?a:e.defaultvalue||0,o;case"url":return o.value="string"==typeof a?a:e.defaultvalue||"",o;case"bool":return o.value=typeof a==typeof!0?a:e.defaultvalue||!1,o;case"date":return o.value="string"==typeof a?a:e.defaultvalue||"2017-12-31",o;case"code":case"urlcode":return o.value=a||e.defaultvalue,o;case"ARRAY":for(var i=[],r=0;r<a.length;r++){var s={datatype:g=guessDatatype(f,a[r]),required:!1,name:null};i.push(_setupObject(t,s,a[r]))}return o.children=i,o.state="closed",o;case"OBJECT":i=[];var d=[];for(var l in a){s={datatype:g=guessDatatype(n.options.registerTypes,a[l]),anydata:!0,required:!1,name:l};i.push(_setupObject(t,s,a[l]))}return o.children=i,o.state="closed",o;default:if(e.basetype&&"OBJECT"==e.basetype){i=[],d=[];if(e.fields)for(r=0;r<e.fields.length;r++){var p=a?a[e.fields[r].name]:null;if(e.fields[r].required||p){d.push(e.fields[r].name);var c=_setupObject(t,e.fields[r],p);i.push(c)}}for(var l in a)if(d.notcontains(l)){s={datatype:g=guessDatatype(n.options.registerTypes,a[l]),anydata:!0,required:!1,name:l};i.push(_setupObject(t,s,a[l]))}return o.children=i,o.state="closed",o}if(e.basetype&&"ARRAY"==e.basetype){i=[];var u=e.allowedTypes,f=[];for(r=0;r<n.options.registerTypes.length;r++)u.contains(n.options.registerTypes[r].datatype)&&f.push(n.options.registerTypes[r]);if(a)for(r=0;r<a.length;r++){var g;s={datatype:g=guessDatatype(f,a[r]),required:!1,name:null};n.options.unregisteredtype.notcontains(g)&&(s.registed=!0),i.push(_setupObject(t,s,a[r]))}return o.children=i,o.state="closed",o}return e}}function loadFilter(t){var e=$.data(this,"jsoneditor");if(e.dataLoaded)return t;e.dataLoaded=!0,$.data(this,"jsoneditor",e);var a={datatype:e.options.roottype,required:!0,name:e.options.rootname};if(e.options.atomtypes.concat(["ARRAY","OBJECT"]).notcontains(e.options.roottype)){var n=getTypeByTypeName(e.options.registerTypes,e.options.roottype);n?a=objExt(a,n):console.log("Error: roottype not found in registerTypes,opt,registerTypes,roottype= ",a,e.options.registerTypes,e.options.roottype)}Object.prototype.toString.apply(t)==Object.prototype.toString.apply([])&&(0!=t.length||"OBJECT"!=a.datatype&&"OBJECT"!=a.basetype||(t={}));var o=_setupObject(this,a,t);return $.parser.parse($(this)),[o]}function setTextHeight(t){if(t.target&&("text"==t.datatype?t.target.style.height=t.valueheight||"300px":t.target.style.height=t.valueheight||"30px",t.children))for(var e=0;e<t.children.length;e++)setTextHeight(t.children[e])}function init(t){return $(t).addClass("jsoneditor"),$(t)}rf.register("jem_command",menuCommand),$.fn.jsoneditor=function(a,t){if("string"!=typeof a)return a=a||{},this.each(function(){var t=$.data(this,"tree");t?$.extend(t.options,a):(t=$.data(this,"jsoneditor",{isChanged:!1,options:$.extend({},$.fn.jsoneditor.parseOptions(this),a,$.fn.jsoneditor.defaults)}),init(this)),t.options.url||t.options.data||(t.options.data={});var e={loadFilter:loadFilter,onExpand:function(t){setTextHeight(t),$.parser.parse($(this))},onLoadSuccess:function(t,e){$.parser.parse($(e.target));var a=this;a||(a=e.target);var n=$(a).jsoneditor("getRoot");setTextHeight(e=$(this).jsoneditor("getData",n.target)),$.parser.parse($(this))},formatter:buildInput};a.url?e.url=a.url:e.data={},$(this).tree(e),$('<div id="'+t.options.menuc_id+'"></div>').appendTo($("body")),$.parser.parse($("body"))});var e=$.fn.jsoneditor.methods[a];return e?e(this,t):this.tree(a,t)},$.fn.jsoneditor.methods={options:function(t){return $.data(t[0],"jsoneditor").options},setUrl:function(t,e){$.data(t[0],"jsoneditor").options.url=e},getUrl:function(t){var e=$.data(t[0],"jsoneditor").options.url;if(e){console.log("url=",e);var a=e.split("?");if(1<a.length){var n=a[1].match(/url=[^\&]*/g);console.log("aa=",n),e=n[0].split("=")[1]}}else e="";return e},isChanged:function(t){return $.data(t[0],"jsoneditor").ischanged},findChildByName:function(t,e){for(var a=e.node,n=e.name,o=$(t[0]).jsoneditor("getChildren",a.target),i=0;i<o.length;i++)if(n==o[i].name)return o[i];return null},validate:function(t){var e=t[0],a=$(e).jsoneditor("getRoot");return validateNode(e,$(e).jsoneditor("getData",a.target))},addChildByName:function(t,e){var a=e.node;a.children&&a.children.length||(a.children=[]);for(var n=e.name,o=0;o<a.fields.length;o++)if(n==a.fields[o].name){var i,r={id:guid(),name:n,wellformated:!0},s=objExt({},a.fields[o]);if(a.fields[o].registed){var d=getTypeByTypeName($.data(t[0],"jsoneditor").options.registerTypes,a.fields[o].datatype);s=objExt(s,d)}if("OBJECT"==(r=objExt(r,s)).datatype||"ARRAY"==r.datatype||"OBJECT"==r.basetype||"ARRAY"==r.basetype)r.state="closed",i="ARRAY"==r.basetype?[]:{},r=_setupObject(t[0],r,i);$(t[0]).jsoneditor("append",{parent:a.target,data:[r]});var l=$(t[0]).jsoneditor("find",r.id);setTextHeight(a),$(t[0]).tree("expand",a.target),$.parser.parse($(l.target)),$.data(t[0],"jsoneditor").ischanged=!0}},addChildByType:function(t,e){var a=e.node;a.children&&a.children.length||(a.children=[]);var n=e.name,o={id:guid(),datatype:n,anydata:!0,wellformated:!0};switch("ARRAY"!=a.datatype&&"ARRAY"!=a.basetype&&(o.name="newattr"),n){case"ARRAY":o.state="closed",o.children=[];break;case"OBJECT":o.children=[],o.state="closed";break;case"str":case"url":o.value="";break;case"number":o.value=0;break;case"bool":o.value=!0;break;case"text":case"date":o.value="";break;default:var i,r=$.data(t[0],"jsoneditor").options.registerTypes;i="ARRAY"==(o=objExt(o,getTypeByTypeName(r,n))).basetype?[]:{},o.state="closed",o=_setupObject(t[0],o,i)}$(t[0]).jsoneditor("append",{parent:a.target,data:[o]});var s=$(t[0]).jsoneditor("find",o.id);setTextHeight(a),$(t[0]).tree("expand",a.target),$.parser.parse($(s.target)),$.data(t[0],"jsoneditor").ischanged=!0},searchUrl:function(e,a){var t,n=$(e[0]).jsoneditor("options");((t=$("#filebrowserw")).length<1&&(t=$('<div id="filebrowserw"><div>').appendTo($("body"))),t).urlbrowser({browsetype:"open",url:n.vc_url+"?action=list",onSelectFile:function(t){$("#"+a+"_v").textbox("setValue",t),$(e).jsoneditor("setNodeValue",{id:a,value:t})}})},getValue:function(t){var e=t[0],a=$(e).jsoneditor("options"),n=$(e).jsoneditor("getRoot"),o=nodeValue($(e).jsoneditor("getData",n.target));return o=o[a.rootname],a.__jename__&&(o.__metadata__={__jename__:a.__jename__}),o},showContextmenu:function(t,e){id=e.id;var a=t[0],n=($(a,"jsoneditor"),$(a).jsoneditor("find",id));n.menubuild||contextMenu(n);var o=$("#"+n.id+"_menuc")[0];x=o.clientLeft+o.offsetLeft,y=o.clientTop+o.offsetTop,$.parser.parse($("#"+n.id+"_menu")),showMenu(a,n,e.event)},setNodeName:function(jq,data){var target=jq[0],node=$(target).jsoneditor("find",data.id);if(node.name=data.value,node.onNameChange){var f=node.onNameChange;if("string"==typeof f)try{f=eval("f="+f),f.call(target,node,data.value)}catch(t){console.log(t,node.onNameChange)}else f.call(target,node,data.value)}$.data(jq[0],"jsoneditor").ischanged=!0},setNodeValue:function(jq,data){var target=jq[0],node=$(target).jsoneditor("find",data.id);if(node.value=data.value,node.onValueChange){var f=node.onValueChange;if("string"==typeof f)try{f=eval("f="+f),f.call(target,node,data.value)}catch(t){console.log(t,node.onValueChange)}else f.call(target,node,data.value)}$.data(jq[0],"jsoneditor").ischanged=!0},deleteNode:function(t,e){var a=$(t[0]).jsoneditor("find",e);$(t[0]).jsoneditor("remove",a.target),$.data(t[0],"jsoneditor").ischanged=!0},destroy:function(t){t.remove()}},$.fn.jsoneditor.parseOptions=function(t){return $.extend({},$.parser.parseOptions(t,["width","height","class"]))};var atomtypes=["str","text","number","url","date","bool","code","urlcode"];$.fn.jsoneditor.defaults={menuc_id:guid(),atomtypes:atomtypes,unregisteredtype:atomtypes.concat(["OBJECT","ARRAY"])},$.parser.plugins.push("jsoneditor")}(jQuery);var ClientTemplate={tbuf:{},tmpl_dir:"/ctmpl",makeUrl:function(t){return ClientTemplate.tmpl_dir+"/"+t+".ctmpl"},loadTmpl:function(t){var e=ClientTemplate.makeUrl(t),a=$.ajax({method:"GET",url:e,cache:!1,async:!1}).responseText;ClientTemplate.tbuf[e]=doT.template(a,void 0,ClientTemplate.tbuf)},getTmpl:function(t){var e=ClientTemplate.makeUrl(t);return ClientTemplate.tbuf.hasOwnProperty(e)||ClientTemplate.loadTmpl(t),ClientTemplate.tbuf[e]},createNew:function(){return ct={render:function(e){var a;try{a=ClientTemplate.getTmpl(e.__ctmpl__)}catch(t){throw debug("render():49",e),t}try{return a(e.data)}catch(t){throw debug("render(),error=",e,a,t),t}},tmplTextRender:function(t,e){return doT.template(t,void 0,ClientTemplate.tbuf)(e)}},ct}};!function(i){function r(t){for(var e=0;e<t.items.length;e++)if(t.items[e].theOne&&t.items[e].theOne())return t.items[e];return null}function s(t,e){console.log("createPanel()",e),e.remoteWidgets&&remoteWidgets(e.remoteWidgets,{},i(t),"replace",function(t){i.messager.alert(t)})}i.fn.oneofcontext=function(e,t){if("string"==typeof e){var a=i.fn.oneofcontext.methods[e];if(a)return a(this,t)}return e=e||{},this.each(function(){debug("construction",this);var t=i.data(this,"oneofcontext");t?i.extend(t.options,e):function(t,e){i(t).addClass("oneofcontext");var a=r(e);isNull(a)||(s(t,a),state=i.data(t,"oneofcontext",{options:e,name:a.name}))}(this,objExt({},i.fn.oneofcontext.defaults,i.fn.oneofcontext.parseOptions(this),e))})},i.fn.oneofcontext.methods={refresh:function(t){var e=t[0],a=i.data(e,"oneofcontext"),n=a.name;console.log("here2",a);var o=r(a.options);isNull(o)?console.log("here is null"):n!=o.name?(console.log("here3",o),s(e,o),console.log("here4",a.options.items),state=i.data(e,"oneofcontext",{options:a.options,name:o.name}),console.log("here5")):console.log("here item equal")},options:function(t){return i.data(t[0],"oneofcontext").options}},i.fn.oneofcontext.parseOptions=function(t){return i.extend({},i.parser.parseOptions(t,["width","height","class"]))},i.fn.oneofcontext.defaults={},i.parser.plugins.push("oneofcontext")}(jQuery),function(r){var o=console.log,i=[];function s(t){var e=t.target,a=r.data(e,"pagingcontext");if(void 0===a){var n=r(e).parents(".pagingcontext");a=r.data(n[0],"pagingcontext"),e=n[0]}return r(e).pagingcontext("resize",{width:r(e).width(),height:r(e).height()}),!1}function d(t,e){var a=t[0],n=r.data(a,"pagingcontext"),o=n.panel.panel("options");o.title=n.options.items[e].label,n.options.items[e].icon&&(opt.iconCls=n.options.items[e].icon),n.panel.panel(o)}function l(t,e){for(var a=t[0],n=r.data(a,"pagingcontext"),o=n.pages.length;o<e;o++)l(t,o);d(t,e);var i=r('<div class="pc_page"></div>').css("width","100%").css("height","100%").css("display","block").appendTo(n.panel.panel("body"));n.pages.push(i),r.data(a,"pagingcontext",n),remoteWidgets(n.options.items[e].remoteWidgets,n.options.items[e].params||{},i,"replace",showError)}r.fn.pagingcontext=function(t,e){if("string"==typeof t){var a=r.fn.pagingcontext.methods[t];if(a)return a(this,e)}return t=t||{},this.each(function(){objExt({},r.fn.pagingcontext.defaults,r.fn.pagingcontext.parseOptions(this),t);try{!function(e,t){r(e).empty(),r(e).addClass("pagingcontext"),t.klass&&r(e).addClass(t.klass),r(e).bind("resize",s);var a=r(e),n=r("<div></div>").css("width",t.width||a.width()).css("height",t.height||a.height()).appendTo(a);r.data(e,"pagingcontext",{options:t,pages:[],currentPage:0,panel:n});var o={width:"100%",height:"100%",title:"will be replaced",tools:[{iconCls:"icon-previous",handler:function(t){r(e).pagingcontext("previous")}},"-",{iconCls:"icon-next",handler:function(t){r(e).pagingcontext("next")}},"-"],closed:!1};n.panel(o),n.on("touchstart",function(t){var e=t.originalEvent.changedTouches[0];i.push({x:e.pageX,y:e.pageY})}),n.on("touchmove",function(t){var e=t.originalEvent.changedTouches[0];i.push({x:e.pageX,y:e.pageY})}),n.on("touchend",function(t){var e=t.originalEvent.changedTouches[0];i.push({x:e.pageX,y:e.pageY});var a=i[i.length-1].x-i[0].x,n=r(t.currentTarget).parents(".pagingcontext");a<-2?n.pagingcontext("next"):2<a&&n.pagingcontext("previous"),i=[]}),l(r(e),0),r(e)}(this,t)}catch(t){throw console.log("e-",t),t}})},r.fn.pagingcontext.methods={show:function(t,e){var a=r.data(t[0],"pagingcontext");a.pages.length<=e&&l(t,e);for(var n=0;n<a.pages.length;n++)a.pages[n].css("display","none");a.pages[e].css("display","block"),a.currentPage=e,r.data(t[0],"pagingcontext",a)},previous:function(t){(e=r.data(t[0],"pagingcontext")).options.items[e.currentPage].onBeforePrevious&&e.options.items[e.currentPage].onBeforePrevious.call(t[0],{oldpage:e.currentPage});var e,a=(e=r.data(t[0],"pagingcontext")).currentPage;if(!(e.currentPage<1)){var n=a-1;e.currentPage=n,t.pagingcontext("show",e.currentPage),d(t,e.currentPage),e.options.items[a].onAfterPrevious&&e.options.items[a].onAfterPrevious.call(t[0],{oldpage:a,newpage:n}),r.data(this,"pagingcontext",e)}},next:function(t){(e=r.data(t[0],"pagingcontext")).options.items[e.currentPage].onBeforeNext&&e.options.items[e.currentPage].onBeforeNext.call(t[0],{oldpage:e.currentPage});var e,a=(e=r.data(t[0],"pagingcontext")).currentPage;if(!(e.currentPage>=e.options.items.length-1)){var n=a+1;e.currentPage=n,t.pagingcontext("show",e.currentPage),d(t,e.currentPage),e.options.items[a].onAfterNext&&e.options.items[a].onAfterNext.call(t[0],{oldpage:a,newpage:n}),r.data(this,"pagingcontext",e)}},select:function(t,e){o("select",t,e);var a=r.data(t[0],"pagingcontext");o("select",a);for(var n=0;n<a.pages.length;n++)pages[n].name==e&&t.pagingcontext("show",n);a.currentPage=newpageid,r.data(this,"pagingcontext",a)},options:function(t){return r.data(t[0],"pagingcontext").options},resize:function(t,e){r.data(t[0],"pagingcontext").panel.panel("resize",e)}},r.fn.pagingcontext.parseOptions=function(t){return r.extend({},r.parser.parseOptions(t,["width","height","class"]))},r.fn.pagingcontext.defaults={},r.parser.plugins.push("pagingcontext")}(jQuery),function(r){function s(t){var e=this,a=r.data(e,"videoplayer"),n=r(this).children("video")[0],o={};a.cur_videourl&&(o.lasturl=a.cur_videourl),remoteCall(a.options.url,"GET","json",o,function(t){isError(t)?showError(t):(n.src=t.url,n.load(),n.paused&&n.play(),r.data(e,"videoplayer").cur_videourl=t.url)},function(t){r.messager.alert("error",t)})}r.fn.videoplayer=function(e,t){if("string"==typeof e){var a=r.fn.videoplayer.methods[e];if(a)return a(this,t)}return e=e||{},this.each(function(){var t=r.data(this,"videoplayer");t?r.extend(t.options,e):function(e,a){var t=getId("video"),n='<video id="'+t+'" controls style="border: 1px solid blue;" height="240" width="320" title="video element">HTML5 Video is required for this example</video>';console.log("s=",n);var o=r(n);r.data(e,"videoplayer",{options:a,playerid:t}),r(e).empty(),o.appendTo(r(e));var i=r(e).children("video")[0];console.log("video=",i),a.url&&s.call(e,a.url),i.onended=function(t){a.onEnded&&a.onEnded.call(e,t),a.url&&s.call(e,a.url)},i.onerror=function(t){a.onError&&a.onError.call(e,t),a.nextUrl&&s.call(e,a.url)}}(this,objExt({},r.fn.videoplayer.defaults,r.fn.videoplayer.parseOptions(this),e))})},r.fn.videoplayer.methods={options:function(t){return r.data(t[0],"videoplayer").options},destroy:function(t){t.remove()}},r.fn.videoplayer.parseOptions=function(t){return r.extend({},r.parser.parseOptions(t,["width","height","class"]))},r.fn.videoplayer.defaults={},r.parser.plugins.push("videoplayer")}(jQuery),function(p){function i(t,e){var a=p(".windowbar-thumbnail",p(t)),n=p.data(t,"windowbar"),o=function(t){var e=p.data(t,"windowbar").options,a=Math.max(p(t).width(),p(t).height());return console.log("opts,maxsize,width,height,iconsize=",e,a,p(t).width(),p(t).height(),e.iconsize),Math.floor(a/(e.iconsize+4)-2)}(t);if(console.log("maxcnt,curcnt=",o,a.length),a.length<=o)a.show(),n.left_arrow.hide(),n.right_arrow.hide();else if("add"==e){var i=a.length-1;a.hide();for(var r=0;r<o;r++)p(a[i--]).show();n.right_arrow.hide(),n.left_arrow.show()}else if(e="delete"){var s=0;for(r=0;r<a.length-1;r++)-1==d&&"none"!=p(a[r]).css("display")&&(d=r),-1!=d&&(s<o&&p(a[r]).show(),s++);n.left_arrow.hide(),o<s?n.right_arrow.show():n.right_arrow.hide()}else if(e="left"){var d=-1,l=a[a.length-1];for(r=0;r<a.length-1;r++)-1==d&&"none"!=p(a[r+1]).css("display")&&(p(a[r]).show(),d=r),-1!=d&&"none"==p(a[r+1]).css("display")&&(p(a[r]).hide(),l=r);"none"!=p(a[a.length-2]).css("display")&&p(a[a.length-1]).hide(),0<d?n.left_arrow.show():n.left_arrow.hide(),l<a.length-1?n.right_arrow.show():n.right_arrow.hide()}else{for(d=-1,l=a[a.length-1],r=0;r<a.length-1;r++)-1==d&&"none"!=p(a[r]).css("display")&&(p(a[r]).hide(),d=r+1),-1!=d&&"none"==p(a[r+1]).css("display")&&(p(a[r+1]).show(),l=r+1);0<d?n.left_arrow.show():n.left_arrow.hide(),l<a.length-1?n.right_arrow.show():n.right_arrow.hide()}}p.fn.windowbar=function(e,t){if("string"==typeof e){var a=p.fn.windowbar.methods[e];if(a)return a(this,t)}return e=e||{},this.each(function(){debug("construction",this);var t=p.data(this,"windowbar");t?p.extend(t.options,e):function(e,t){p(e).addClass("windowbar"),"width"==t.direct?p(e).css({width:t.width||"100%",border:1,height:2*(t.margin||4)+t.iconsize||16}):p(e).css({width:2*(t.margin||4)+t.iconsize||16,border:1,height:t.height||"100%"}),p.parser.parse(p(e)),console.log("width,height=",p(e).width(),p(e).height());var a=p("<span/>").hide();a.addClass("leftarrow"),a.appendTo(p(e)),a.click(function(t){console.log("hahah"),p(e).windowbar("moveleft",t)});var n=p("<span/>");n.addClass("rightarrow").hide().appendTo(p(e)),n.click(function(t){console.log("hahah"),p(e).windowbar("moveright",t)}),p.data(e,"windowbar",{options:t,left_arrow:a,right_arrow:n,windows:[]}),p(e).resize(function(){i(e,"resize")})}(this,objExt({},p.fn.windowbar.defaults,p.fn.windowbar.parseOptions(this),e))})},p.fn.windowbar.methods={options:function(t){return p.data(t[0],"windowbar").options},deleteWindow:function(t,e){var a=e.attr("w_id");console.log("deleteWindow,wid=",a),p('span[w_id="'+a+'"]',t).remove();var n=p.data(t[0],"windowbar");console.log("1 windows=",n.windows);for(var o=0;o<n.windows.length;o++)if(a==n.windows[o].attr("w_id")){n.windows[o],n.windows.splice(o,1);break}console.log("2 windows=",n.windows),i(t[0],"add")},addWindow:function(t,e){var a=p.data(t[0],"windowbar");e.attr("showed",1),a.windows.push(e),p(".windowbar-current-window",p(t[0])).removeClass("windowbar-current-window"),console.log("wobj=",e);var n=e.window("options").iconCls||"windowbar-default-iconCls";p("<span/>").attr("w_id",e.attr("w_id")).addClass("windowbar-thumbnail").addClass(n).hide().appendTo(t).click(function(t){var e=p(this).attr("w_id"),a=p(this).parent(".windowbar"),n=p.data(a[0],"windowbar");console.log("windows=",n.windows);for(var o=null,i=0;i<n.windows.length;i++)if(n.windows[i].attr("w_id")==e){o=n.windows[i];break}o&&(console.log("window found"),1==o.attr("showed")?(o.attr("showed",0),o.window("minimize"),console.log("window minimized")):(o.attr("showed",1),o.window("open"),console.log("window restored")))});i(t[0],"add")},destroyWindow:function(t,e){},selectWindow:function(t,e){},moveleft:function(t,e){i(t[0],"left")},moveright:function(t,e){i(t[0],"right")},destroy:function(t){t.remove()}},p.fn.windowbar.parseOptions=function(t){return p.extend({},p.parser.parseOptions(t,["width","height"]))},p.fn.windowbar.defaults={},p.parser.plugins.push("windowbar")}(jQuery),function($){var loaded=!1,prevOpenedApp,currentOpenedApp,rf=RegisterFunction.createNew();function initLayout(a){var t=$(a),n=$.data(a,"app").options,e=$("<div/>").attr({border:!1,region:"center"}).addClass("app-wall").appendTo(t);e.bind("contextmenu",function(t){var e=$.data(a,"app").appContainer;e&&t.target!=e[0]||(n.onWallContextMenu.call(a,t),t.preventDefault())}),n.wallpaper&&e.css("background-image",'url("'+n.wallpaper+'")'),"BODY"!==t.tagName&&t.attr("fit",!0);({south:!0,north:!0,west:!0,east:!0})[n.taskBlankPos]||(n.taskBlankPos="south");var o=$("<div/>").attr({border:!1,region:n.taskBlankPos}).css({overflow:"hidden"}).appendTo(t);"north"==n.taskBlankPos||"south"==n.taskBlankPos?o.css("height",35):o.css("width",35),t.layout();var i=$("<div/>").appendTo(e).calendar({current:new Date}).hide().css({position:"absolute","z-index":100});$.data(a,"app").calendarDiv=i,e.panel({onResize:function(t,e){setTaskListWidth(a)}})}function initTaskBlank(e){var t=$(e),a=$.data(e,"app").options,n=t.layout("panel",a.taskBlankPos),o=$("<div/>").addClass("app-taskBar"),i=$("<div/>");i.addClass("lbox");var r=$("<div/>");r.addClass("lbox");var s="width";"east"!=a.taskBlankPos&&"west"!=a.taskBlankPos||(s="height");var d={iconsize:a.iconSize,direct:s};r.windowbar(d);var l=$("<div/>"),p=browser();console.log("$.browser=",p),p.ie&&i.hover(function(){$(this).addClass("app-startMenu-hover")},function(){$(this).removeClass("app-startMenu-hover")}),"south"==a.taskBlankPos||"north"==a.taskBlankPos?(o.addClass("app-taskBar-bg1"),i.addClass("app-startMenu-x"),l.addClass("app-taskBar-calendar-x")):(o.addClass("app-taskBar-bg2"),i.addClass("app-startMenu-y"),l.addClass("app-taskBar-calendar-y")),i.appendTo(o),r.appendTo(o),l.appendTo(o),o.appendTo(n),$.data(e,"app").taskBar=o,$.data(e,"app").start=i,$.data(e,"app").taskList=r,$.data(e,"app").calendar=l,r.bind("contextmenu",function(t){"LI"==t.target.nodeName?a.onTaskBlankContextMenu.call(e,t,$(t.target).attr("l_id")):a.onTaskBlankContextMenu.call(e,t,!1)}),setTaskListWidth(e)}function setTaskListWidth(t){var e=$(t),a=$.data(t,"app").options,n="width";"south"!=a.taskBlankPos&&"north"==a.taskBlankPos&&(n="height");for(var o=e.layout("panel",a.taskBlankPos),i=$.data(t,"app").taskList,r=i.siblings(),s=0,d=0;d<r.length;d++)s+="width"==n?$(r[d]).width():$(r[d]).height();"width"==n?(console.log("l=",s,"pw = ",o.width()),i.width(o.width()-s)):i.height(o.height()-s)}function initApp(e,t){var a=$(e),n=$.data(e,"app").options,o=a.layout("panel","center"),i=a.data().app.appContainer,r=Math.floor((o.height()-20)/(n.iconSize+45)),s=Math.floor((o.width()-20)/(n.iconSize+45)),d=(o.height()-20-(n.iconSize+45)*r)/r,l=(o.width()-20-(n.iconSize+45)*s)/s,p=1,c=20,u=10,f=n.iconSize+45;for(var g in t){r<p&&(p=1,c=20,u+=f+l,0);var h=t[g],v=$("<li/>").css({height:f,width:f});v.data("app",h),v.attr("app_id",UUID()),h.id&&v.attr("id",h.id),v.css({left:u,top:c});$("<img/>").height(n.iconSize).width(n.iconSize).attr("src",h.icon).appendTo(v),$("<span/>").text(h.text).appendTo(v),$("<em/>").css({height:f,width:f}).appendTo(v);v.appendTo(i),c+=f+d,p++,b=browser(),b.ie&&v.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}),initAppDrag(e,v),n.dbClick?v.on("dblclick",function(){openApp.call(this,e)}):v.on("click",function(){openApp.call(this,e)})}var m=i.children("li");m.mousedown(function(){m.removeClass("select"),$(this).addClass("select")}).bind("contextmenu",function(t){n.onAppContextMenu.call(e,t,$(this).attr("app_id")),t.preventDefault()})}function initAppDrag(a,t){t.draggable({revert:!0,cursor:"default"}).droppable({onDrop:function(t,e){$(e).prev().attr("app_id")==$(this).attr("app_id")?$(e).insertBefore(this):$(e).insertAfter(this),setTimeout(function(){appReset(a)},0)},accept:".app-container li"})}function initStartMenu(e){$(e);var t=$.data(e,"app").options;t.loadUrl.startMenu&&!loaded&&remoteCall(t.loadUrl.startMenu,"GET","json",{},function(t){try{if(console.log("menu data=",t),isNull(t))return $.messager.alert("error","not a widget file"),void console.log("menu data=",data,t,w);initMenu(e,t)}catch(t){return void $.messager.alert("error","not a widget file"+t)}},function(t){$.messager.alert("error",t)})}function initMenu(target,menus){var jqTarget=$(target),opts=$.data(target,"app").options,wall=jqTarget.layout("panel","center"),startMenuDiv;$(tmplRender("menu",menus.data)).appendTo($("body")),$.parser.parse($("body")),startMenuDiv=$("#"+menus.data.id),$.parser.parse(startMenuDiv);var obj=eval("d = obj_"+menus.data.id);console.log("startmenu=",startMenuDiv,obj);var start=$.data(target,"app").start,left=0,top=0;start.click(function(t){t.pageY-=16,obj.setValue({data:{target:target},event:t})}),start.data("menu",startMenuDiv)}function setCalendarTopAndLeft(t){var e=$.data(t,"app").calendarDiv,a=$.data(t,"app").options,n={};"south"==a.taskBlankPos||"east"==a.taskBlankPos?(n.bottom=0,n.right=0):"west"==a.taskBlankPos?(n.bottom=0,n.left=0):(n.top=0,n.right=0),e.css(n)}function initCalendar(t){var e=$(t),n=$.data(t,"app").options,o=$.data(t,"app").calendar;function a(){var t=new Date,e=r.call(t,n.dateFmt);if(o.attr("title",r.call(t,"yyyy-MM-dd")),"south"==n.taskBlankPos||"north"==n.taskBlankPos)o.html(e);else{var a=t.getHours()+":";t.getMinutes()<10&&(a+="0"),a+=t.getMinutes(),o.html(a)}}a(),window.setInterval(function(){a()},1e3);var i=$.data(t,"app").calendarDiv;function r(t){t||(t="yyyy-MM-dd hh:mm:ss");var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t}setCalendarTopAndLeft(t),o.click(function(){i.slideToggle()}),e.click(function(t){var e=$(t.target).attr("class");"app-taskBar-calendar-x"==e||"app-taskBar-calendar-y"==e||$.contains(i[0],t.target)||i.hide()})}function openUrl(t,e){var a=e.url,n=e.iconCls,o=i18n(e.label||e.name),i=$.data(t,"app");n||(n="windowbar-default-iconCls");var r={title:o,width:"800px",height:"600px",iconCls:n,onClose:function(t){i.taskList.windowbar("deleteWindow",$(this)),$(this).window("destroy")}},s=$("<div />").appendTo($("body"));(s.attr("w_id",getId("window")),s.attr("w_url",a),console.log("****,obj=",s),s.window(r),$.parser.parse($("body")),i.taskList.windowbar("addWindow",s),/^http/i.test(a))?$("<iframe/>").attr({width:"100%",height:"99%",frameborder:0,src:a}).appendTo(s.window("body")):remoteWidget(a,{},s.window("body"),"replace",showSysError)}function createWindow(t,e){return openApp(t,e)}function UUID(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"UUID-"+(t()+t())+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function setWallpaper(t,e){$(t).layout("panel","center").css("background-image",'url("'+e+'")'),$.data(t,"app").options.wallpaper=e}rf.register("openApp",function(t){console.log(t,t[0].data),target=t[0].data.target,openUrl(target,t[0].data)});var initMethods=[initLayout,initTaskBlank,initStartMenu,initCalendar];function init(t,e){if(!loaded){$.messager.progress({title:e.lang.progress.title,msg:e.lang.progress.msg,interval:null});var a=$.messager.progress("bar");for(var n in $.ajaxSetup({async:!1}),initMethods){var o=initMethods[n];a.progressbar({text:e.lang[o.name]}).progressbar("setValue",(parseInt(n)+1)/initMethods.length*100),o.call(this,t)}$.messager.progress("close"),$.ajaxSetup({async:!0}),loaded=!0,e.onLoaded.call(t),setTimeout(function(){$("body").attr({oncontextmenu:"return false",onselectstart:"return false",ondragstart:"return false",onbeforecopy:"return false"})},500)}}$.fn.app=function(e,t){return"string"==typeof e?$.fn.app.methods[e.toLowerCase()].call(this,t):(e=e||{},this.each(function(){var t=$.data(this,"app");t?(e=$.extend(t.options,e),t.options=e):(e=$.extend({},$.fn.app.defaults,$.fn.app.parseOptions,e),$.data(this,"app",{options:e})),init(this,e)}))},$.fn.app.methods={options:function(){return this.data().app.options},appcontainer:function(){return this.data().app.appContainer},calendar:function(){return this.data().app.calendar},start:function(){return this.data().app.start},taskbar:function(){return this.data().app.taskBar},tasklist:function(){return this.data().app.taskList},startmenu:function(){return this.data().app.start.data().menu},layout:function(){return this.data().layout},setwallpaper:function(t){return this.each(function(){setWallpaper(this,t)})},appreset:function(){return this.each(function(){appReset(this)})},seticonsize:function(e){return this.each(function(){$.data(this,"app").options.iconSize=e;var t=$.data(this,"app").appContainer;t.find("img").height(e).width(e),t.find("em,li").height(e+45).width(e+45),appReset(this)})},closeapp:function(t){$("#"+t).dialog("close")},openapp:function(t){$("#"+t).dialog("open")},createmenu:function(t){return createMenu(this[0],t.data,t.opt||{})},createwindow:function(t){return createWindow(this[0],t)},refreshapp:function(t){refresh(this[0],t)}},$.fn.app.parseOptions=function(){},$.fn.app.defaults={taskBlankPos:"south",iconSize:32,dbClick:!0,dateFmt:"yyyyMMdd <br/> hh:mm:ss",wallpaper:null,onTaskBlankContextMenu:function(t,e){},onWallContextMenu:function(t){},onAppContextMenu:function(t,e){},onBeforeOpenApp:function(t){},onLoaded:function(){},onOpenApp:function(){},onClosedApp:function(){},onStartMenuClick:function(t){},iframeOpen:!1,loadUrl:{startMenu:"json/startMenu.js"},lang:{initLayout:"init layout",initTaskBlank:"init task blank",initStartMenu:"init start menu",initCalendar:"init calendar",progress:{title:"Please waiting",msg:"Loading data..."}}},$.parser.plugins.push("app")}(jQuery),function(s){function i(t,e,a){s(t).empty();var n="",o='style="height:24px;width:'+(e.width||"100px")+'"';e.readonly&&(o+="disabled "),n="<select "+o+">";for(var i=0;i<a.length;i++)n+='<option value="'+a[i][e.valueField]+'"',a[i][e.valueField]==e.value&&(n+=" selected"),n+=">"+a[i][e.textField]+"</option>";var r=s(n+="</select>");return r[0].addEventListener("change",function(t){e.onChange&&e.onChange.call(r,t.srcElement.value,null)}),r}s.fn.selectbox=function(e,t){if("string"==typeof e){var a=s.fn.selectbox.methods[e];if(a)return a(this,t)}return e=e||{},this.each(function(){debug("construction",this);var t=s.data(this,"selectbox");t?s.extend(t.options,e):function(a,n){if(s(a).addClass("selectbox"),n.url){var t=objExt({},n.params||{});remoteCall(n.url,"GET","json",t,function(t){var e=i(a,n,t);e.appendTo(s(a)),s.data(a,"selectbox",{options:n,selectobj:e})},function(t){s.messager,alert("error",t)})}else if(n.data){var e=i(a,n,n.data);e.appendTo(s(a)),s.data(a,"selectbox",{options:n,selectobj:e})}}(this,objExt({},s.fn.selectbox.defaults,s.fn.selectbox.parseOptions(this),e))})},s.fn.selectbox.methods=objExt({},s.fn.validatebox.methods,{reload:function(t,e,a){void 0===a&&(a={});var n=t[0],o=s.data(n,"selectbox").options;a=objExt({},o.params||{},a);remoteCall(o.url,"GET","json",a,function(t){i(n,o,t).appendTo(s(n))},function(t){s.messager,alert("error",t)})},setValue:function(t,e){var a=t[0];s.data(a,"selectbox").selectobj.val(e)},getValue:function(t){var e=t[0];return s.data(e,"selectbox").selectobj.val()}}),s.fn.selectbox.parseOptions=function(t){return s.extend({},s.parser.parseOptions(t,["valuewidth","valueheight","class"]))},s.fn.selectbox.defaults=s.extend({},s.fn.combo.defaults,{}),s.parser.plugins.push("selectbox")}(jQuery),function(o){function i(t,e){var a=o("input",t);a.css("display","none"),e?(a[0].checked=!0,o(t).addClass("onoff-on")):(a[0].checked=!1,o(t).removeClass("onoff-on"))}function n(a,n){o(a).addClass("onoff"),o(a).empty(),o('<input type="checkbox" value="" name=""/>').appendTo(o(a));var t=o('<div class="box"><span></span></div>');t.appendTo(o(a)),o.data(a,"onoff",{options:n,readonly:n.readonly,onoffobj:t}),o("input",a).css("display","none"),i(a,n.value),o.parser.parse(o(a)),t[0].onclick=function(t){if(!o.data(a,"onoff").readonly){var e=!0;o("input",a)[0].checked&&(e=!1),i(a,e),console.log("onclick() options=",n),n.onChange&&n.onChange.call(a,e,null)}}}o.fn.onoff=function(e,t){if("string"==typeof e){var a=o.fn.onoff.methods[e];if(a)return a(this,t)}return e=e||{},this.each(function(){debug("construction",this);var t=o.data(this,"onoff");t?o.extend(t.options,e):n(this,objExt({},o.fn.onoff.defaults,o.fn.onoff.parseOptions(this),e))})},o.fn.onoff.methods={options:function(t){return o.data(t[0],"onoff").options},disable:function(t){state=o.data(t[0],"onoff"),state.readonly=!0},enable:function(t){state=o.data(t[0],"onoff"),state.readonly=!1},getValue:function(t){var e=t[0];return o("input",e)[0].checked},setValue:function(t,e){var a=t[0];o("input",a)[0].checked=e}},o.fn.onoff.parseOptions=function(t){return o.extend({},o.parser.parseOptions(t,["width","height","class"]))},o.fn.onoff.defaults=o.extend({},o.fn.textbox.defaults,{on:!1}),o.parser.plugins.push("onoff")}(jQuery),function(r){function o(t,e,a){var n=r.data(t,"scripteditor"),o=n.jqText,i=a-n.jqStatus.height();o.css("width",e-10),o.css("height",i-10)}function n(n,t){r(n).addClass("scripteditor"),r(n).css("width",t.width||t.valuewidth||"100%"),r(n).css("height",t.height||t.valueheight||"100%"),r(n).empty();var e=r('<textarea class="scripteditor-text" ></textarea>');e.appendTo(r(n));var a=r('<div class="scripteditor-status"></div>');r(n).keydown(function(t){!function(t,e){switch(e.keyCode){case 9:var a=r.data(t,"scripteditor"),n=a.jqText.val();n+="\t",a.jqText.val(n),e.preventDefault()}}(n,t)});r.data(n,"scripteditor",{options:t,data:t.value?t.value:"",jqText:e,jqStatus:a}),r.parser.parse(r(n)),r(n).resize(function(t,e,a){o(n,r(n).width(),r(n).height())}),o(n,r(n).width(),r(n).height())}r.fn.scripteditor=function(e,t){if("string"==typeof e){var a=r.fn.scripteditor.methods[e];if(a)return a(this,t)}return e=e||{},this.each(function(){debug("construction",this);var t=r.data(this,"scripteditor");t?r.extend(t.options,e):n(this,objExt({},r.fn.scripteditor.defaults,r.fn.scripteditor.parseOptions(this),e))})},r.fn.scripteditor.methods={options:function(t){return r.data(t[0],"scripteditor").options},setValue:function(t,e){r.data(t[0],"scripteditor").jqText.val(e)},getValue:function(t){return r.data(t[0],"scripteditor").jqText.val()}},r.fn.scripteditor.parseOptions=function(t){return r.extend({},r.parser.parseOptions(t,["valuewidth","valueheight","class"]))},r.fn.scripteditor.defaults={},r.parser.plugins.push("scripteditor")}(jQuery),function(i){i.fn.edatagrid=function(a,t){if("string"!=typeof a)return a=i.extend({singleSelect:!0,scrollOnSelect:!0,fit:!1,rowStyler:function(t,e){return t%2==0?"background-color:#f4f4f4":"background-color:#ffffff"},toolbar:[{iconCls:"icon-add",handler:function(){i(".edatagrid",i(this).parents(".datagrid")).edatagrid("add")}},"-",{iconCls:"icon-remove",handler:function(){i(".edatagrid",i(this).parents(".datagrid")).edatagrid("delete")}},"-",{iconCls:"icon-edit",handler:function(){i(".edatagrid",i(this).parents(".datagrid")).edatagrid("update")}},"-",{iconCls:"icon-uparrow",handler:function(){i(".edatagrid",i(this).parents(".datagrid")).edatagrid("moveup")}},"-",{iconCls:"icon-downarrow",handler:function(){i(".edatagrid",i(this).parents(".datagrid")).edatagrid("movedown")}}]},a),this.each(function(){var t=i.data(this,"edatagrid");t?i.extend(t.options,a):(t=i.data(this,"edatagrid",{editMode:"none",editIndex:null,oldEditRow:null,userOnSelect:a.onSelect,userOnUnSelect:a.onUnselect,userOnAfterEdit:a.onAfterEdit,options:i.extend({},i.fn.edatagrid.parseOptions(this),a,i.fn.edatagrid.defaults)}),function(t){i(t).addClass("edatagrid"),i(t)}(this));var e=i.extend(a,{onUnselect:function(t,e){i(this).edatagrid("finishEdit");var a=i.data(this,"edatagrid");a.userOnUnselect&&a.userOnUnselect.call(this,t,e)},onSelect:function(t,e){i(this).edatagrid("finishEdit");var a=i.data(this,"edatagrid");a.userOnSelect&&a.userOnSelect.call(this,t,e)},onAfterEdit:function(t,e,a){i(this);var n=i.data(this,"edatagrid");n.newEditRow=e,"add"==n.editMode?n.options.onAdded&&n.options.onAdded.call(this,e):"update"==n.editMode&&n.options.onUpdated&&n.options.onUpdated.call(this,n.oldEditRow,e),n.oldEditRow=null,n.editMode="none",n.userOnAfterEdit&&n.userOnAfterEdit.call(this,t,e,a)}});i(this).datagrid(e),i.parser.parse(i(this))});var e=i.fn.edatagrid.methods[a];return e?e(this,t):(e=i.fn.datagrid.methods[a],this.datagrid(a,t))},i.fn.edatagrid.methods={options:function(t){return i.data(t[0],"edatagrid").options},getEditIndex:function(t){return i.data(t[0],"edatagrid").editIndex},setEditIndex:function(t,e){var a=i.data(t[0],"edatagrid");a.editIndex=e,i.data(t[0],"edatagrid",a)},getEditMode:function(t){return i.data(t[0],"edatagrid").editMode},setEditMode:function(t,e){var a=i.data(t[0],"edatagrid");a.EditMode=e,i.data(t[0],"edatagrid",a)},moveup:function(t){var e=t;e.edatagrid("finishEdit");var a=i(e).edatagrid("getSelected");a&&(index=i(e).edatagrid("getRowIndex",a),0!==index&&(i(e).edatagrid("insertRow",{index:index-1,row:a}),i(e).edatagrid("deleteRow",index+1),e.edatagrid("selectRow",index-1)))},movedown:function(t){var e=t;e.edatagrid("finishEdit");var a=i(e).edatagrid("getSelected");if(a){index=i(e).edatagrid("getRowIndex",a);var n=i(e).edatagrid("getData");index>=n.rows.length-1||(i(e).edatagrid("insertRow",{index:index+2,row:a}),i(e).edatagrid("deleteRow",index),e.edatagrid("selectRow",index+1))}},beginEditRow:function(t,e){0<=i(t).edatagrid("getEditIndex")&&i(t).edatagrid("finishEdit"),i(t).edatagrid("setEditIndex",e),i(t).edatagrid("beginEdit",e)},finishEdit:function(t){var e=i(t).edatagrid("getEditIndex");null!=e&&void 0!==e&&0<=e&&(i(t).edatagrid("endEdit",e),i(t).edatagrid("setEditIndex",null))},add:function(t){var e=t;e.edatagrid("finishEdit");var a=0,n=i(e).edatagrid("getSelected");n?(a=i(e).edatagrid("getRowIndex",n),a+=1,e.edatagrid("insertRow",{index:a,row:{}})):(n={},e.edatagrid("appendRow",n),a=i(e).edatagrid("getData").rows.length-1);var o=i.data(t[0],"edatagrid");o.editMode="add",i.data(t[0],"edatagrid",o),e.edatagrid("selectRow",a),e.edatagrid("beginEditRow",a)},update:function(t){var e=t;e.edatagrid("finishEdit");var a,n=i(e).edatagrid("getSelected");if(n){var o=i.data(t[0],"edatagrid");o.oldEditRow=n,o.editMode="update",i.data(t[0],"edatagrid",o),console.log("row=",n),a=i(e).edatagrid("getRowIndex",n),e.edatagrid("beginEditRow",a)}},delete:function(t){grid=t,grid.edatagrid("finishEdit");var e=i(grid).edatagrid("getSelected");if(e){var a=i(grid).edatagrid("getRowIndex",e);i(grid).edatagrid("deleteRow",a);var n=i.data(t[0],"edatagrid");n.options.onDeleted&&n.options.onDeleted.call(t[0],e);var o=i(grid).edatagrid("getData");a>=o.rows.length&&(a=o.rows.length-1),grid.edatagrid("selectRow",a)}},destroy:function(t){t.remove()}},i.fn.edatagrid.parseOptions=function(t){return i.extend({},i.parser.parseOptions(t,["width","height","class"]))},i.fn.edatagrid.defaults={},i.parser.plugins.push("edatagrid")}(jQuery),function(f){function l(t,e,a,n,o,i,r,s,d){var l=f('<div class="lbox"></div>').css("cursor","pointer").addClass(n),p=a||16,c='<img src="'+o+'" width="'+(p=p.toString()+"px")+'" height="'+p+'" />',u="";return e||(u="<br>"),c+=u,f(c+="<span>"+i+"</span>").appendTo(l),r&&l.tooltip({content:i18n(r)}),l.bind("click",d,s),l}function r(t,e,a,n,o,i,r,s,d){return l(0,e,a,n,o,i,r,s,d).appendTo(f(t))}function o(t,e,a){var n=a.name;a.label&&(n=a.label),n=i18n(n);var o="tb_item";a.klass&&(o=o+" "+a.klass);var i=r(t,e.inline,e.imgsize,o,a.img_url,n,a.tip,a.handler||e.handler,a);return i.attr("name",a.name),i}function i(t,e){var a=f(t).width(),n=f(".tb_item",t);if(0!=n.length){var o=Math.floor(a/n.length);if(e<=o)return n.css("width",o),n.css("display","block"),f(".tb_left",f(t)).css("display","none"),void f(".tb_right",f(t)).css("display","none");for(var i=Math.floor(a/e)-2,r=f.data(t,"toolbar"),s=0;s<n.length;s++){var d="none";s>=r.showStart&&s<r.showStart+i&&(d="block"),f(n[s]).css("display",d)}f(".tb_left",f(t)).css("display","block"),f(".tb_right",f(t)).css("display","block"),r.showCount=i,f.data(t,"toolbar",r)}}function s(t){var e=f.data(t.target,"toolbar");i(t.target,e.options.min_width)}function d(t){var e=f(t.target).parents(".toolbar")[0],a=f.data(e,"toolbar"),n=f(".tb_item",f(e));a.showStart+a.showCount>=n.length||(a.showStart+=1,f.data(e,"toolbar",a),i(e,a.options.min_width))}function p(t){var e=f(t.target).parents(".toolbar")[0],a=f.data(e,"toolbar");0!=a.showStart&&(a.showStart-=1,f.data(e,"toolbar",a),i(e,a.options.min_width))}function n(t,e,a){r(t,e.inline,e.imgsize,"tb_left",e.leftimg_url,i18n("left"),"move left",p).css("display","none");for(var n=0;n<a.length;n++)o(t,e,a[n]);r(t,e.inline,e.imgsize,"tb_right",e.rightimg_url,i18n("right"),"move right",d).css("display","none"),i(t,e.min_width),f(t).bind("resize",s)}f.fn.toolbar=function(e,t){if("string"==typeof e){var a=f.fn.toolbar.methods[e];if(a)return a(this,t)}return e=e||{},this.each(function(){var t=objExt({},f.fn.toolbar.defaults,f.fn.toolbar.parseOptions(this),e);!function(e,a){if(f(e).addClass("toolbar").css("height",a.height).css("align","center").css("text-align","center"),a.klass&&f(e).addClass(a.klass),f.data(e,"toolbar",{options:a,showStart:0}),a.tools_url){var t={};a.params&&(t=a.param),remoteCall(a.tools_url,"GET","json",t,function(t){n(e,a,t)},showError)}else n(e,a,a.tools)}(this,t),f.data(this,"toolbar",{options:t,showStart:0})})},f.fn.toolbar.methods={options:function(t){var e=t[0];return f.data(e,"toolbar").options},add:function(t,e){var a=t[0],n=f.data(a,"toolbar"),o=e.name;e.label&&(o=e.label),o=i18n(o);var i="tb_item";e.klass&&(i=i+" "+e.klass);var r=l(0,n.options.inline,n.options.imgsize,i,e.img_url,o,e.tip,e.handler||n.options.handler,e);r.attr("name",e.name),f(".tb_right").before(r)},delete:function(t,e){f('.tb_item[name="'+e+'"]').remove()}},f.fn.toolbar.parseOptions=function(t){return f.extend({},f.parser.parseOptions(t,["min_width","height","klass"]))},f.fn.toolbar.defaults={min_width:36,height:34,imgsize:16,leftimg_url:"/imgs/leftarrow.png",rightimg_url:"/imgs/rightarrow.png"},f.parser.plugins.push("toolbar")}(jQuery),function(o){function i(t){var e=o(t.target).attr("href");if(console.log("url=",e),e.startsWith("https://")||e.startsWith("http://"))window.open(e);else{console.log("ghjkl;");var a=o(t.target).parents(".markdown");remoteWidget(e,{},a,"replace",showError)}return!1}function n(t,e){var a=o('<div class="md_body"></div>').css("width","100%").css("height","100%").appendTo(o(t)),n=(new showdown.Converter).makeHtml(e);o(n).appendTo(a),o("a",o(t)).bind("click",i)}o.fn.markdown=function(e,t){if("string"==typeof e){var a=o.fn.markdown.methods[e];if(a)return a(this,t)}return e=e||{},this.each(function(){var t=o.data(this,"markdown");t?o.extend(t.options,e):function(e,a){console.log("init()..."),o(e).addClass("markdown"),a.klass&&o(e).addClass(a.klass),console.log("init().1."),o.data(e,"markdown",{options:a}),console.log("init().2."),a.md_url?(console.log("init().3."),remoteCall(a.md_url,"GET","text",{},function(t){console.log("data=",t,"url=",a.md_url),n(e,t)},function(t){o.messager,alert("error",t)})):a.md_text&&(console.log("init().4."),n(e,a.md_text)),console.log("init().5.")}(this,objExt({},o.fn.markdown.defaults,o.fn.markdown.parseOptions(this),e))})},o.fn.markdown.methods={options:function(t){return o.data(t[0],"markdown").options}},o.fn.markdown.parseOptions=function(t){return o.extend({},o.parser.parseOptions(t,["valuewidth","valueheight","class"]))},o.fn.markdown.defaults=o.extend({},o.fn.combo.defaults,{}),o.parser.plugins.push("markdown")}(jQuery),function(r){function o(t){r.messager.show({title:"hint",msg:"back callback() called"});var e=r(this).parents(".mobileapp");console.log("mobileapp=",e),e.mobileapp("goback")}function a(t,e,a){r.data(t,"mobileapp");var n=r(".appbody",r(t)),o=r(".apppage",n);0<o.length&&(o.css("display","none"),r(".appback").css("display","block"));var i=r('<div class="apppage"></div>').css("width","100%").css("height","100%").appendTo(n);remoteWidget(e,a,i,"replace",showError)}function n(t,e){return r(t).addClass("mobileapp"),r(t).empty(),function(t){r('<div class="appbody"></div>').css("width","100%").css("height","100%").appendTo(r(t))}(t),function(t,e){var a=r('<div class="appback"></div>');a.appendTo(r(t));var n=r(t).css("z-index");void 0===n&&(n=5e3),a.css("z-index",n+1e3),a.css("display","none"),a.css("cursor","pointer"),a.css("position","absolute"),a.css("top","1px"),a.css("left","1px"),r('<img width="18px" height="18px" src="'+e+'" />').appendTo(a),a.bind("click",o)}(t,e.backimg_url),r.data(t,"mobileapp",{options:e,curStep:0}),a(t,e.url),r.data(t,"mobileapp",{options:e}),t}r.fn.mobileapp=function(e,t){if("string"==typeof e){var a=r.fn.mobileapp.methods[e];if(a)return a(this,t)}return e=e||{},this.each(function(){var t=r.data(this,"mobileapp");t?r.extend(t.options,e):n(this,objExt({},r.fn.mobileapp.defaults,r.fn.mobileapp.parseOptions(this),e))})},r.fn.mobileapp.methods={options:function(t){return r.data(t[0],"mobileapp").options},goback:function(t){var e=r(".apppage",t);if(1<e.length){cp=e.length-1,op=cp-1;var a=e[cp];r(e[cp]).css("display","none"),r(e[op]).css("display","block"),e.splice(e[cp],1),a.remove(),e.length<2&&r(".appback",t).css("display","none")}},newpage:function(t,e){t[0];a(t[0],e.url,e.params)},destory:function(t){r.data(t,"mobileapp",null),t.remove()},activate:function(t){t.css("display","block"),1<r(".apppage",t).length&&r(".appback",t).css("display","block")},unactivate:function(t){r(".appback",t).css("display","none"),t.css("display","none")}},r.fn.mobileapp.parseOptions=function(t){return r.extend({},r.parser.parseOptions(t,["width","height","class"]))},r.fn.mobileapp.defaults={backimg_url:"/imgs/leftarrow.png"},r.parser.plugins.push("mobileapp")}(jQuery),function(o){function n(t){var e=o(".pagebody",o(this)),a=o(".pagecontent",e);0<a.length&&a.css("display","none");var n=o('.pagecontent[name="'+t.name+'"]',e);0<n.length?n.css("display","block"):((n=o('<div class="pagecontent"></div>')).css("width","100%"),n.css("height","100%"),n.attr("name",t.name),n.appendTo(e),remoteWidget(t.url,{},n,"replace",showError),o("a",n).bind("click",r))}function i(t){var e=o(t.target).parents(".menupage");0<e.length&&n.call(e[0],t.data)}function r(t){var e=o(this).parents(".mobileapp");if(0<e.length){var a={url:this.attr("href"),params:{}};e.mobileapp("newpage",a)}}function s(t){var e=t.target,a=o(".toolbar",o(e)),n=o(".pagebody",o(e));n.css("height",o(e).height()-a.height()-4),n.css("width",o(e).width())}function d(t,e){o(t).css("width","100%").css("height","100%"),o(t).addClass("menupage"),o(t).empty(),o.data(t,"menuapp",{options:e}),o('<div class="pagebody"></div>').appendTo(o(t)),function(t,e){var a=o.extend({},e.menu);return a.handler=i,o("<div></div>").toolbar(a)}(0,e).appendTo(o(t)),s({target:t});var a=function(t,e){for(var a=0;a<t.tools.length;a++)if(t.tools[a].name==e)return t.tools[a];return null}(e.menu,e.showwhich);n.call(t,a),o(t).bind("resize",s),o.parser.parse(o(t))}o.fn.menupage=function(e,t){if("string"==typeof e){var a=o.fn.menupage.methods[e];if(a)return a(this,t)}return e=e||{},this.each(function(){var t=o.data(this,"menupage");t?o.extend(t.options,e):d(this,o.extend({},o.fn.menupage.defaults,o.fn.menupage.parseOptions(this),e))})},o.fn.menupage.methods={options:function(t){return o.data(t[0],"menupage").options}},o.fn.menupage.parseOptions=function(t){return o.extend({},o.parser.parseOptions(t,["width","height","class"]))},o.fn.menupage.defaults={on:!1},o.parser.plugins.push("menupage")}(jQuery);